<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>misc.utf8</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/sandstone.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 61px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h2 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h3 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h4 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h5 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h6 {
  padding-top: 66px;
  margin-top: -66px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<div class="container-fluid main-container">

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->





<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Anna M. Tucker</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="projects.html">Research</a>
</li>
<li>
  <a href="pubs.html">Publications</a>
</li>
<li>
  <a href="teaching.html">Teaching</a>
</li>
<li>
  <a href="files/tucker-cv.pdf">CV</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">




</div>


<p><br><br></p>
<div id="miscellaneous-and-potentially-useful" class="section level3">
<h3>Miscellaneous and potentially useful</h3>
<p><strong>ditching the for loop once and for all</strong></p>
<p>I converted to the <a href="https://www.tidyverse.org/">tidyverse</a> about a year ago, and fully embraced the pipe (<code>%&gt;%</code>) and intuitive functions as part of my workflow. However, I would still find myself falling back on use for loops for row-wise computations, like:</p>
<pre class="r"><code>df = data.frame(a = runif(50, 10, 50),
                b = rbinom(1, 1, 0.5))

for(i in 1:nrow(df)){
  df$c[i] = ifelse(df$b[i] == 1, df$a[i] + 10, df$a[i] - 10)
}</code></pre>
<p>I knoooow that for loops are slow and inefficient, but they are intuitive to write (if not always intuitive to read) and I have a deep lack of understanding of <code>apply</code>. I also know that the <code>purrr</code> package is designed specifically to eliminate the need for things like loops, but had never really figured out exactly how <code>map()</code> and its related functions work (<code>pmap</code>, <code>map2</code>, etc etc). HOWEVER, I think <a href="https://github.com/jennybc/row-oriented-workflows#readme">this excellent tutorial</a> from Jenny Bryan finally changed my mind. Turn the above into something more like:</p>
<pre class="r"><code>require(tidyverse)

fn = function(a, b){
  ifelse(b == 1, a + 10, a - 10)
}

df %&gt;% 
  mutate(cnew = map2_dbl(a, b, fn))</code></pre>
<pre><code>##           a b        c     cnew
## 1  41.74930 1 51.74930 51.74930
## 2  48.31584 1 58.31584 58.31584
## 3  24.01200 1 34.01200 34.01200
## 4  14.25611 1 24.25611 24.25611
## 5  40.41893 1 50.41893 50.41893
## 6  12.14125 1 22.14125 22.14125
## 7  22.67085 1 32.67085 32.67085
## 8  27.41920 1 37.41920 37.41920
## 9  34.77310 1 44.77310 44.77310
## 10 22.39172 1 32.39172 32.39172
## 11 29.69698 1 39.69698 39.69698
## 12 48.88390 1 58.88390 58.88390
## 13 40.05811 1 50.05811 50.05811
## 14 31.88674 1 41.88674 41.88674
## 15 49.95871 1 59.95871 59.95871
## 16 32.32144 1 42.32144 42.32144
## 17 44.39401 1 54.39401 54.39401
## 18 19.97688 1 29.97688 29.97688
## 19 42.06280 1 52.06280 52.06280
## 20 18.92377 1 28.92377 28.92377
## 21 35.97768 1 45.97768 45.97768
## 22 11.35471 1 21.35471 21.35471
## 23 40.32740 1 50.32740 50.32740
## 24 14.94151 1 24.94151 24.94151
## 25 40.32113 1 50.32113 50.32113
## 26 13.73105 1 23.73105 23.73105
## 27 24.69296 1 34.69296 34.69296
## 28 13.18517 1 23.18517 23.18517
## 29 46.74811 1 56.74811 56.74811
## 30 19.43817 1 29.43817 29.43817
## 31 26.28430 1 36.28430 36.28430
## 32 19.40099 1 29.40099 29.40099
## 33 13.42840 1 23.42840 23.42840
## 34 24.81408 1 34.81408 34.81408
## 35 36.67040 1 46.67040 46.67040
## 36 23.00417 1 33.00417 33.00417
## 37 18.87236 1 28.87236 28.87236
## 38 38.76914 1 48.76914 48.76914
## 39 10.53681 1 20.53681 20.53681
## 40 13.28874 1 23.28874 23.28874
## 41 48.13879 1 58.13879 58.13879
## 42 10.14159 1 20.14159 20.14159
## 43 44.75373 1 54.75373 54.75373
## 44 38.86575 1 48.86575 48.86575
## 45 30.54911 1 40.54911 40.54911
## 46 12.03265 1 22.03265 22.03265
## 47 14.53824 1 24.53824 24.53824
## 48 22.71835 1 32.71835 32.71835
## 49 49.72653 1 59.72653 59.72653
## 50 38.86589 1 48.86589 48.86589</code></pre>
<p>It didn’t really make a difference here, but this has substanstially sped up some of my simulations and also makes the code much more readable, in my opinion.</p>
<p>Check out the webinar. Highly recommended!</p>
<hr />
<p><strong>the ultimate way to run JAGS</strong></p>
<p>If you’ve worked with JAGS you know that it can sometimes be finicky about initializing. A few years ago I started using this little bit of code to force JAGS to keep trying to initialize. Not the most elegant way to go about it, but sometimes it’s what needs to be done.</p>
<pre class="r"><code>success = FALSE
while(!success){
    s &lt;- try(mod &lt;- jags(dat, inits, params, model.file,
                             n.chains = nc, n.iter = ni, n.adapt = na,
                             n.burnin = nb, n.thin = nt, parallel = T))
    success &lt;- class(s)!=&#39;try-error&#39;
}</code></pre>
<p>Essentially this just keeps retrying the <code>jags()</code> call until it sticks. <em>Note: be sure to check initial values, data, and model first before trying this–many times there is a real reason JAGS doesn’t like what you’re trying to do!</em></p>
<p>I also like to automatically check for convergence and update if needed, which you can do by adding:</p>
<pre class="r"><code>while(length(which(reknmod$summary[,8] &gt; 1.1)) &gt; 0){
    mod = update(mod, n.iter = 15000, parameters.to.save = params)
}</code></pre>
<p>I often run models over the weekend, or on a lab machine that’s down the hall. In these cases, I like R to send me little updates so I can obsessively worry about how my model is doing instead of enjoying some free time or doing something else productive. There are a lot of options out there for this, but the one that works great for me is <a href="https://pushover.net/">Pushover</a>. You create an account online and register your device, and then use the <code>pushoverr</code> package to send push notifications from R to your phone. It’s amazing. Adding that to the above gives us:</p>
<pre class="r"><code>success = FALSE
while(!success){
    s &lt;- try(mod &lt;- jags(dat, inits, params, model.file,
                             n.chains = nc, n.iter = ni, n.adapt = na,
                             n.burnin = nb, n.thin = nt, parallel = T))
    success &lt;- class(s)!=&#39;try-error&#39;
    pushover(&quot;error initializing, rerunning&quot;)
}

while(length(which(mod$summary[,8] &gt; 1.1)) &gt; 0){
    pushover(&quot;not converged, updating&quot;)
    mod = update(mod, n.iter = 15000, parameters.to.save = params)
 }

pushover(&quot;model finished!&quot;)</code></pre>
<p>I’ve also started to care more about benchmarking my models and keeping track of how long they took. Again, there are a bunch of ways to do this, but I like the <code>tictoc</code> package for its simplicity. You just use <code>tic()</code> right before the code you want to time and <code>toc()</code> after. I also added a line of code to save the model once its finished, just in case I can’t get to the computer right away. So, putting it all together:</p>
<pre class="r"><code>require(jagsUI)
require(tictoc)
require(pushoverr)

success = FALSE
while(!success){
  s &lt;- try(mod &lt;- jags(dat, inits, params, model.file,
                           n.chains = nc, n.iter = ni, n.adapt = na,
                           n.burnin = nb, n.thin = nt, parallel = T))
  success &lt;- class(s)!=&#39;try-error&#39;
  pushover(&quot;error initializing, rerunning&quot;)
}

while(length(which(mod$summary[,8] &gt; 1.1)) &gt; 0){
  pushover(&quot;not converged, updating&quot;)
  mod = update(mod, n.iter = 15000, parameters.to.save = params)
}

saveRDS(mod, file = &quot;filename.rds&quot;)

pushover(paste(&quot;finished!&quot;, unlist(tic.log())))</code></pre>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
